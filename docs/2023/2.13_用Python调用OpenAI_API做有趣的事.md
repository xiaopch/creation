# 用Python调用OpenAI API做有趣的事

GPT 迭代过程概要表：

版本	发布时间	训练方案	参数量	是否开放接口

GPT(GPT-1)	2018 年 6 月	无监督学习	1.17 亿	是

GPT-2	2019 年 2 月	多任务学习	15 亿	是

GPT-3	2020 年 5 月	海量参数	1,750 亿	是

ChatGPT(GPT-3.5)	2022 年 12 月	针对对话场景优化	1,750 亿	否

GPT-4	未发布	万亿参数	100万亿	否

这篇文章描述的是，如何对接 GPT-3 的开放 API，它是目前 OpenAI 开放接口的最新版本。

#### 获取 API KEY

首先需要 可以开全局的梯子，选择日本或韩国节点，可以通过 ipinfo 检查当前 IP 地址是否为日本或韩国地区，然后访问 OpenAI 网站注册账号并完成认证。

如果自己完成账号认证的成本太高，可以在某宝直接购买一个已经通过认证的 OpenAI 账号

获得可用 OpenAI 账号后，访问 View API keys -> API Keys 页面，点击 Create new secret key 获取一个 openai.api_key 再继续后面的内容。

使用 Python 调用 OpenAI API 的方式非常便捷，只需安装 OpenAI 提供的 openai 库就可以调用其 API 服务：

```
pip install openai
```



#### OpenAI 文本编写

调用 openai.Completion.create 函数需要了解几个基本参数：

model: 要使用的模型的 ID，访问 OpenAI Docs Models 页面可以查看全部可用的模型

prompt: 生成结果的提示文本，即你想要得到的内容描述

max_tokens: 生成结果时的最大 tokens 数，不能超过模型的上下文长度，可以把结果内容复制到 OpenAI Tokenizer 来了解 tokens 的计数方式

temperature: 控制结果的随机性，如果希望结果更有创意可以尝试 0.9，或者希望有固定结果可以尝试 0.0

top_p: 一个可用于代替 temperature 的参数，对应机器学习中 nucleus sampling，如果设置 0.1 意味着只考虑构成前 10% 概率质量的 tokens

frequency_penalty: [控制字符的重复度] -2.0 ~ 2.0 之间的数字，正值会根据新 tokens 在文本中的现有频率对其进行惩罚，从而降低模型逐字重复同一行的可能性

`presence_penalty`: [控制主题的重复度] *-2.0 ~ 2.0* 之间的数字，正值会根据到目前为止是否出现在文本中来惩罚新 **tokens**，从而增加模型谈论新主题的可能性（以云课堂的广告文案为例）

stop: 最大长度为 4 的字符串列表，一旦生成的 tokens 包含其中的内容，将停止生成并返回结果

#### 故事创作

输入 prompt 内容：

主题: 早餐 风
		两句话的恐怖故事:

#### 完整的调用代码：

```
import openai
openai.api_key = 'xx-xxxxxxxx'

response = openai.Completion.create(
  model='text-davinci-003',
  prompt='主题: 早餐 风\n两句话的恐怖故事:',
  temperature=0.8,
  max_tokens=120,
  top_p=1.0,
  frequency_penalty=0.5,
  presence_penalty=0.0,
)

print(response.choices[0].text)
```
### 写诗歌

```
写一首情人节的诗
写一首诗，李白风格的
写一宋词，苏轼风格的
```
### 餐厅评论

```
根据这些笔记写一篇餐厅评论
名称：大头鱼烧烤
茄子很棒，很吵，服务态度好，价格便宜。
评论：
```

### 头脑风暴

```
集思广益，提出一些结合AI和自动化测试的想法：
```

### 广告文案

```
为以下产品写一则创意广告，在微博上针对家长进行宣传：
产品：云课堂是一个网络平台，帮助从幼儿园到高中的学生在学校表现出色。
```

### 论文大纲

```
为一篇关于《浮士德》中魔鬼形象及其矛盾性的文章创建一个大纲
```

### 学习笔记

```
研究中国古代文论时我应该知道的5个要点是什么？
```

### 创建食谱

```
根据这些食材编写食谱：黑椒蛋炒饭
食材：黑胡椒 农家土鸡蛋 隔夜的木桶饭 切小块的香肠 葱花
食谱：
```

### 推荐书单

```
推荐10本育儿方面的书：
```

### 产品名称

```
根据下面的描述想几个产品名称
产品描述：夜灯
种子词：适合婴儿 可以啃咬 续航整晚 小巧
产品名称：
```

### 电子邮件

```
帮我给张三写一封邮件，祝他生日快乐，同时祝贺他获得晋升。
```



